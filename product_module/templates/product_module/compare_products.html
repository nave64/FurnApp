{% extends 'shared/_layout.html' %}
{% load poll_extras %}
{% block title %} مقایسه محصولات {% endblock %}

{% block content %}
<section class="compare-section pt-90 pb-90">
    <div class="container">
        <h2 class="text-center mb-5">مقایسه محصولات</h2>

        {% if products %}
        <!-- 🔼 Product Selector Section (Top) -->
        <div class="row justify-content-center mb-5">
            <div class="col-lg-6 col-md-8 col-sm-12">
                <div class="card p-4 shadow-sm">
                    <form method="post" action="{% url 'add_to_compare' %}">
                        {% csrf_token %}
                        <div class="form-group mb-3 text-right" dir="rtl">
                            <label for="product_id"><strong>افزودن محصول دیگر برای مقایسه:</strong></label>
                            <select name="product_id" id="product_id" class="form-control">
                                {% for p in available_products %}
                                    <option value="{{ p.id }}">{{ p.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="select-btn w-100 mt-4">افزودن به مقایسه</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 🟦 Compared Products Section -->
        <div class="row">
            {% for product in products %}
            <div class="col-lg-6 col-md-6 col-sm-12">
                <div class="compare-card p-4 border rounded shadow-sm text-center mb-4 h-100">
                    <img src="{{ product.image.url }}" alt="{{ product.title }}" class="img-fluid mb-3" style="max-height: 200px; object-fit: contain;">
                    <h4 class="mb-2">{{ product.title }}</h4>

                    <p class="mb-1">قیمت: <strong>{{ product.price|three_digits_currency }}</strong></p>

                    {% if product.discount_price %}
                        <p class="mb-1 text-danger">قیمت تخفیفی: <strong>{{ product.discount_price|three_digits_currency }}</strong></p>
                    {% endif %}

                    <p class="mb-1">موجودی:
                        {% if product.product_quantity %}
                            <span class="badge bg-success">موجود</span>
                        {% else %}
                            <span class="badge bg-danger">ناموجود</span>
                        {% endif %}
                    </p>

                    <div class="mt-3 text-right" dir="rtl">
                        <p class="small text-muted">توضیح کوتاه:</p>
                        <div class="text-justify" style="font-size: 0.95rem;">{{ product.short_description|safe }}</div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        {% else %}
        <p class="text-center">هیچ محصولی برای مقایسه انتخاب نشده است.</p>
        {% endif %}
    </div>
<div class="text-center mb-4">
    <a href="{% url 'clear_compare' %}" class="btn btn-danger">
        پاک کردن لیست مقایسه
    </a>
</div>

</section>
{% endblock %}
