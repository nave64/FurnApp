<!-- Top Header (md+) -->
<div class="header__top d-none d-md-block pt-2 pb-2">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-xxl-2 col-xl-2 col-lg-2 col-md-6 d-none d-xl-block">
                <div class="header__top-info"></div>
            </div>
            <!-- Links & Social -->
            <div class="header__extra-links d-flex justify-content-between align-items-center flex-wrap mt-3">
                <div class="header__links d-flex flex-wrap gap-3">
                    <a href="{% url 'rules_page' %}" class="header__link">قوانین و مقررات</a>
                    <a href="{% url 'shipment_page' %}" class="header__link">روش‌های ارسال</a>
                    <a href="{% url 'payment_methods_page' %}" class="header__link">روش‌های پرداخت</a>
                    <a href="{% url 'refund_terms_page' %}" class="header__link">شرایط بازگشت کالا</a>
                </div>
                <div class="header__social d-flex gap-3 align-items-center">
                    <a href="{{ site_settings.instagram_address }}" target="_blank"><i class="fa fa-instagram"></i></a>
                    <a href="{{ site_settings.telegram_link }}" target="_blank"><i class="fab fa-telegram-plane"></i></a>
                    <a href="{{ site_settings.whatsapp_number }}" target="_blank"><i class="fab fa-whatsapp"></i></a>
                    <div class="logo text-center">
                        <a href="{% url 'index_page_urls' %}">
                            <img src="{{ site_settings.site_logo.url }}" alt="لوگو" class="img-fluid rounded-circle shadow-sm" style="max-width: 80px;">
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Desktop Header (lg+) -->
<header class="d-none d-lg-block" dir="rtl">
    <div class="header__area">
        <!-- Middle Section -->
        <div class="header__middle header__border grey-bg-3 d-none d-md-block pt-2 pb-2">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-xxl-6 col-xl-6 col-lg-6">
                        <div class="header__search-3">
                            <form action="{% url 'search' %}" method="get">
                                <div class="header__search-input-2 header__search-input-3">
                                    <input class="input" type="text" name="q" placeholder="جستجوی محصولات ">
                                    <button type="submit"><i class="fa fa-search"></i></button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="col-xxl-6 col-xl-6 col-lg-6">
                        <div class="header__middle-right header__middle-right-d d-flex align-items-center justify-content-end">
                            <div class="sd-contact">
                                <span>تماس سریع با کارشناس فروش :<a href="tel:+0889006690">+123456789</a></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Nav Menu -->
        <div class="header__bottom black-bg d-none d-xl-block" dir="rtl">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-xxl-12 col-lg-8 col-sm-6 col-4">
                        <div class="main-menu main-menu-3">
                            <nav id="mobile-menu">
                                <ul>
                                    <!-- Debug: Current URL: {{ request.resolver_match.url_name }} -->
                                    <li class="{% if request.resolver_match.url_name == 'index_page_urls' %}active{% endif %}"><a href="{% url 'index_page_urls' %}">صفحه اصلی</a></li>
                                    <li class="{% if 'product' in request.resolver_match.url_name %}active{% endif %}"><a href="{% url 'product_list' %}">فروشگاه</a></li>                                    
                                    <li class="{% if 'blog' in request.resolver_match.url_name %}active{% endif %}"><a href="{% url 'blog_list' %}">مجله اینترنتی</a></li>
                                    <li class="{% if 'contact' in request.resolver_match.url_name %}active{% endif %}"><a href="{% url 'contact_page_urls' %}">تماس با ما</a></li>
                                    <!-- <li><a href="shop.html">انتخاب و خرید پارچه مبلی</a></li> -->

                                    {% if request.user.is_authenticated %}
                                        <li><a href="{% url 'user_basket_page' %}" class="position-relative">
                                            <i class="fa fa-shopping-cart"></i> سبد خرید
                                            <span class="cart-count-badge" id="cart-count-badge">0</span>
                                        </a></li>
                                        <li><a href="{% url 'user_panel_urls' %}" class="text-warning">مشاهده پنل کاربری</a></li>

                                        {% if request.user.is_superuser %}
                                            <li><a href="{% url 'admin:index' %}" class="text-warning">پنل مدیریت</a></li>
                                        {% endif %}

                                        <li><a href="javascript:void(0);" onclick="confirmLogout()">خروج</a></li>
                                    {% else %}
                                        <li><a href="{% url 'login_page' %}">ورود</a></li>
                                        <li><a href="{% url 'register_page' %}">ثبت نام</a></li>
                                    {% endif %}
                                </ul>
                            </nav>
                        </div>

                        <!-- Mobile toggle button (hidden on xl) -->
                        <div class="header-bar mb-5 d-xl-none">
                            <button type="button" class="header-bar-btn header-bar-btn-2" data-bs-toggle="modal" data-bs-target="#offCanvasModal">
                                <span></span>
                                <span></span>
                                <span></span>
                            </button>
                        </div>
                    </div>
                    <div class="col-sm-6 col-8 col-lg-4">
                        <div class="logo-d d-xl-none text-sm-end">
                            <img src="{{ site_settings.site_logo.url }}" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Mobile Header (lg-) -->
<div class="mobile-header-area pt-2 pb-2 d-lg-none bg-white">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-6">
                <div class="mobile-logo">
                    <a href="{% url 'index_page_urls' %}">
                        <img src="{{ site_settings.site_logo.url }}" alt="لوگو" class="img-fluid rounded-circle shadow-sm" style="max-width: 70px;">
                    </a>
                </div>
            </div>
            <div class="col-6 text-end">
                <button class="header-bar-btn" data-bs-toggle="modal" data-bs-target="#offCanvasModal">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>

        <!-- ✅ Mobile Search Form -->
        <div class="row mt-3">
            <div class="col-12">
                <form action="{% url 'search' %}" method="get">
                    <div class="input-group">
                        <input type="text" name="q" class="form-control" placeholder="جستجوی محصولات...">
                        <button type="submit" class="btn btn-dark"><i class="fa fa-search"></i></button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Offcanvas Mobile Menu -->
<div class="modal fade" id="offCanvasModal" tabindex="-1">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content" dir="rtl">
            <div class="modal-header">
                <h5 class="modal-title">منوی موبایل</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <ul class="nav flex-column gap-3">
                    <li class="{% if request.resolver_match.url_name == 'index_page_urls' %}active{% endif %}"><a href="{% url 'index_page_urls' %}" class="nav-link">صفحه اصلی</a></li>
                    <li class="{% if 'product' in request.resolver_match.url_name %}active{% endif %}"><a href="{% url 'product_list' %}" class="nav-link">فروشگاه</a></li>
                    <li class="{% if 'blog' in request.resolver_match.url_name %}active{% endif %}"><a href="{% url 'blog_list' %}" class="nav-link">مجله اینترنتی</a></li>
                    <li class="{% if 'contact' in request.resolver_match.url_name %}active{% endif %}"><a href="{% url 'contact_page_urls' %}" class="nav-link">تماس با ما</a></li>
                    <!-- <li><a href="shop.html" class="nav-link">انتخاب و خرید پارچه مبلی</a></li> -->
                    {% if request.user.is_authenticated %}
                        <li><a href="{% url 'user_basket_page' %}" class="nav-link position-relative">
                            <i class="fa fa-shopping-cart"></i> سبد خرید
                            <span class="cart-count-badge" id="cart-count-badge-mobile">0</span>
                        </a></li>
                        <li><a href="shop.html" class="nav-link text-warning">مشاهده پنل کاربری</a></li>
                        {% if request.user.is_superuser %}
                            <li><a href="{% url 'admin:index' %}" class="nav-link text-warning">پنل مدیریت</a></li>
                        {% endif %}
                        <li><a href="javascript:void(0);" onclick="confirmLogout()" class="nav-link">خروج</a></li>
                    {% else %}
                        <li><a href="shop.html" class="nav-link">ورود</a></li>
                        <li><a href="{% url 'register_page' %}" class="nav-link">ثبت نام</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>
</div>
